// –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç –æ—Ç API
const apiResponse = $input.first().json;
const timings = apiResponse.data.timings;

// –ö–û–†–†–ï–ö–¶–ò–Ø –í–†–ï–ú–ï–ù–ò: –°–µ—Ä–≤–µ—Ä EST (-05:00) ‚Üí –£—Ñ–∞ (+05:00) = +10 —á–∞—Å–æ–≤
const now = new Date();
const ufaTime = new Date(now.getTime() + (10 * 60 * 60 * 1000)); // +10 —á–∞—Å–æ–≤

// –ù–∞–º–∞–∑—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
const prayers = [
  { name: '–§–∞–¥–∂—Ä', key: 'Fajr' },
  { name: '–ó—É—Ö—Ä', key: 'Dhuhr' },
  { name: '–ê—Å—Ä', key: 'Asr' },
  { name: '–ú–∞–≥—Ä–∏–±', key: 'Maghrib' },
  { name: '–ò—à–∞', key: 'Isha' }
];

let result = {
  currentTime: ufaTime.getHours().toString().padStart(2, '0') + ':' + ufaTime.getMinutes().toString().padStart(2, '0'),
  nextPrayer: null,
  nextPrayerTime: null,
  timeLeft: null,
  shouldNotify: false
};

// –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π –Ω–∞–º–∞–∑
for (const prayer of prayers) {
  const [prayerHours, prayerMinutes] = timings[prayer.key].split(':').map(Number);
  
  // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–º–∞–∑–∞ –≤ –£—Ñ–µ
  const prayerTime = new Date(ufaTime);
  prayerTime.setHours(prayerHours, prayerMinutes, 0, 0);
  
  // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É –≤ –º–∏–Ω—É—Ç–∞—Ö
  const diffMs = prayerTime - ufaTime;
  const diffMinutes = Math.floor(diffMs / (1000 * 60));
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –†–û–í–ù–û 5 –º–∏–Ω—É—Ç
  if (diffMinutes === 5) {
    result.nextPrayer = prayer.name;
    result.nextPrayerTime = timings[prayer.key];
    result.timeLeft = diffMinutes;
    result.shouldNotify = true;
    console.log(`üïå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: ${prayer.name} —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç (${timings[prayer.key]})`);
    break;
  }
}

// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
if (result.shouldNotify) {
  return [result];
} else {
  return [];
}
